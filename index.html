<script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const frameImg = new Image();
        
        // --- 1. SET YOUR FRAME FILE NAME HERE ---
        const frameFileName = 'frame.png'; 
        
        // --- 2. CONFIGURATION ---
        let userImg = null;
        
        // Load the frame
        frameImg.src = frameFileName; 

        frameImg.onload = () => { 
            console.log("Frame loaded successfully!");
            drawCanvas(); 
        };

        // ERROR HANDLING: If the image is missing, this runs
        frameImg.onerror = () => { 
            alert("⚠️ ERROR: Could not find '" + frameFileName + "'. \n\nI will draw a red border instead so you can still test the upload.");
            // Draw a fake frame so you can still test the app
            drawCanvas();
        };

        // Handle File Upload
        document.getElementById('upload').addEventListener('change', function(e) {
            if(e.target.files && e.target.files[0]){
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        userImg = img;
                        drawCanvas();
                    }
                    img.src = event.target.result;
                }
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        function drawCanvas() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 1. Draw User Image (Simple Center)
            if (userImg) {
                // simple center logic for testing
                const scale = Math.max(canvas.width / userImg.width, canvas.height / userImg.height);
                const x = (canvas.width / 2) - (userImg.width / 2) * scale;
                const y = (canvas.height / 2) - (userImg.height / 2) * scale;
                ctx.drawImage(userImg, x, y, userImg.width * scale, userImg.height * scale);
            } else {
                ctx.fillStyle = "#eee";
                ctx.fillRect(0,0, canvas.width, canvas.height);
                ctx.fillStyle = "#333";
                ctx.font = "40px Arial";
                ctx.fillText("Upload a Photo", 400, 500);
            }

            // 2. Draw Frame OR Red Box if missing
            if (frameImg.complete && frameImg.naturalHeight !== 0) {
                ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);
            } else {
                // DRAW RED BORDER IF IMAGE IS MISSING
                ctx.strokeStyle = "red";
                ctx.lineWidth = 50;
                ctx.strokeRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = "red";
                ctx.font = "40px Arial";
                ctx.fillText("Frame Image Missing", 350, 100);
            }
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'abvp-festive-post.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>